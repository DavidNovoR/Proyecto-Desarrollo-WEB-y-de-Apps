<?php
session_start();
require_once "conexion.php"; // aquÃ­ va TU archivo PDO

if ($_SERVER["REQUEST_METHOD"] !== "POST") {
    exit("Acceso no permitido");
}

$emailOrUser = trim($_POST["email"] ?? "");
$password    = $_POST["password"] ?? "";

if ($emailOrUser === "" || $password === "") {
    exit("Campos vacÃ­os");
}

// Buscar por email o por usuario
$sql = "SELECT * FROM Users
        WHERE email = :login OR usuarios = :login
        LIMIT 1";

$stmt = $pdo->prepare($sql);
$stmt->execute([
    "login" => $emailOrUser
]);

$user = $stmt->fetch(PDO::FETCH_ASSOC);

if (!$user) {
    exit("Usuario o contraseÃ±a incorrectos");
}

// Verificar contraseÃ±a
if ($password !== $user["password"])
    exit("Usuario o contraseÃ±a incorrectos");
}

// LOGIN CORRECTO ðŸŽ‰
$_SESSION["user_id"] = $user["id"];
$_SESSION["usuario"] = $user["usuarios"];
$_SESSION["rol"] = $user["rol"];

// Redirigir
header("Location: dashboard.php");
exit;
